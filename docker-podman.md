
# MISC 
Containers are composed of layers (os, deps, updates, etc.)

```
podman machine start/stop
podman machine ls   # running machines
podman ps   # running containers, us -a for all

podman run <image-name>
podman info  # settings

podman ps -aq -f --status=exited  # see dead containers
podman container prune  # del dead containers
```

pull down an image from configured repo  
`podman pull <image>:<version>`  latest is default  
check stored images  
`podman images`  
browse inside image  
`podman run -it <image-name> sh`  
stop container  
`podman stop <container-id>`  

run containers w/o keeping snapshots on disk  
`podman run --rm -it <image>`  
port mapping - bind a local port to the container  
`podman run -d -P --name <port-name> <image>`  # capital P picks random port, port name is opt  
see port info  
`podman port <port-name>`  

deleteing  
`podman image prune`  # delete dangling images  
`podman image prune -a`  # delete any image not tied to a container
`podman rmi <image-id>` # delete image
`docker container prune` # delete all stopped containers
`podman rm <container-id>`
`docker system prune -a` # delete all unused conatianers and images


# BUILDING IMAGES
`nvim Dockerfile`  # optional name: Containerfile  

```docker
FROM golang:version
WORKDIR /app  # container path to work with
COPY  main.go .  # copy local files to build, source target
RUN go build -o main.go .
EXPOSE 8080  # optional
CMD ["./main"]   # run bin when container starts
```

`podman build .`  
`podman build -t <tag-name> .`  


# COMPOSE
multi image containers  
create a `docker-compose.yaml`  
containers are under the `services` header  




### TO ORGANIZE

Give me a single markdown block of all the docker commands we used. Include explanations for each one, including the flags used. 
markdown
•  docker compose: Use Docker Compose to manage multi-container applications
•  --profile server: Only start services tagged with the "server" profile (excludes transcribe services)
•  up: Create and start containers
•  -d: Run in detached mode (in the background)

2. Check Running Container Status
bash
•  docker compose: Docker Compose command
•  --profile server: Target only "server" profile services
•  ps: Show status of containers (similar to docker ps but for compose services)

3. Restart All Services
bash
•  docker compose: Docker Compose command
•  --profile server: Target only "server" profile services
•  restart: Stop and then start containers (preserves volumes and networks)

4. View Container Logs
bash
•  docker compose: Docker Compose command
•  --profile server: Target only "server" profile services
•  logs: Display log output from services

5. View Logs with Tail Limit
bash
•  docker compose: Docker Compose command
•  --profile server: Target only "server" profile services
•  logs: Display log output from services
•  --tail 20: Only show the last 20 lines of logs

6. View Logs for Specific Service
bash
•  docker compose: Docker Compose command
•  --profile server: Target only "server" profile services
•  logs: Display log output from services
•  app: Only show logs from the "app" service (Joplin Server)

7. View Logs with Filtering
bash
•  docker compose --profile server logs app: Get logs from app service
•  |: Pipe output to next command
•  tail -10: Show only the last 10 lines

8. Filter Logs with Grep
bash
•  docker compose --profile server logs app: Get logs from app service
•  |: Pipe output to next command
•  grep -i: Search for patterns (case-insensitive)
•  "base\|url\|listening\|server": Search for lines containing any of these words

9. Execute Command Inside Running Container
bash
•  docker exec: Execute a command in a running container
•  joplin-app-1: Name of the container (auto-generated by compose)
•  env: Command to run inside container (show environment variables)
•  |: Pipe output to next command
•  grep APP_BASE_URL: Filter to show only lines containing "APP_BASE_URL"

10. Stop and Remove All Services
bash
•  docker compose: Docker Compose command
•  --profile server: Target only "server" profile services
•  down: Stop containers and remove containers, networks, and volumes created by up

11. Start Services After Full Cleanup
bash
•  Same as command #1 - start services in detached mode
•  Used after down to completely recreate containers with fresh configuration

Key Points:
•  Profiles: The --profile server flag ensures we only manage the Joplin server and PostgreSQL, excluding transcribe services
•  Service Names: Container names are auto-generated as {directory}-{service}-{number} (e.g., joplin-app-1)
•  Detached Mode: The -d flag runs containers in background, returning control to terminal
•  Log Management: Various log commands help debug issues and monitor server status
•  Environment: docker exec allows inspecting running container's environment and configuration

